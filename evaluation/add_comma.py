import os
import sys

def fix_json(input_file: str):
    """
    Fixes the JSON file by adding commas between objects and formatting it as a proper JSON array.
    The output file name is generated by appending '_comma.json' to the input file name.
    """
    # Generate output file name by appending '_comma.json' to the input file name
    base_name, ext = os.path.splitext(input_file)
    output_file = f"{base_name}_comma.json"

    # Read the input file
    with open(input_file, "r") as infile:
        lines = infile.readlines()
    
    # Add commas between lines and format as a JSON array
    with open(output_file, "w") as outfile:
        outfile.write("[\n")  # Start of JSON array
        for i, line in enumerate(lines):
            line = line.strip()  # Remove any extra spaces
            if not line:
                continue  # Skip empty lines
            outfile.write(line)
            if i < len(lines) - 1:
                outfile.write(",\n")  # Add comma after each object except the last
        outfile.write("\n]")  # End of JSON array

    print(f"Fixed JSON written to {output_file}")

if __name__ == "__main__":
    # Check for command-line arguments
    if len(sys.argv) < 2:
        print("Usage: python fix_json.py <input_file>")
        sys.exit(1)

    # Get the input file name from the command-line arguments
    input_file = sys.argv[1]

    # Validate the input file
    if not os.path.isfile(input_file):
        print(f"Error: File '{input_file}' does not exist.")
        sys.exit(1)

    # Call the function to fix the JSON
    fix_json(input_file)